# 1. Подготовка сервера

**30 минут**
- IPMI
- RAID
- сетевые интерфейсы 

# 2. Установка ОС

**30 минут**

# 3. Подготовка к установке РВ

**1 час**
1. Хранилище 
2. Установка и обновление пакетов для РВ
3. Настройка файервола

# 4. Установка РВ

1. **1 час**  для нового хоста в кластера
2. **1-30 час** для первого хоста в кластере
   




---

# Руководство по внедрению РЕД Виртуализации 7.3


---

## 1. Подготовка сервера (время выполнения: до 30 минут)

### 1.1 Доступ по IPMI

- Убедитесь, что IPMI активен, конфигурирован и доступен по сети.
    
- Выполните проверку состояния аппаратных компонентов.
    

### 1.2 Конфигурация RAID

- Войдите в BIOS RAID-контроллера (Ctrl+R / Ctrl+C в зависимости от модели).
    
- Создайте массив RAID10 (рекомендуется для рабочих нагрузок Engine и ВМ).
    
- Выполните полную инициализацию массива.
    

### 1.3 Сетевые интерфейсы

- Отключите все порты, кроме одного, перед установкой РВ (требование инсталлятора).
    
- Настройте VLAN, если необходимо (например, через BIOS или preboot настройки NIC).
    

---

## 2. Установка операционной системы (время выполнения: до 30 минут)

### 2.1 Установочный образ

- Используйте образ РЕД ОС 7.3, редакция «Минимальный сервер».
    
- Проверка контрольной суммы ISO обязательна.
    

### 2.2 Этапы установки

1. Установить язык интерфейса и раскладку.
    
2. Указать дату и время, активировать NTP.
    
3. Разметка дисков вручную:
    
    - `/boot` — 1 ГБ
        
    - `/var` — не менее 20 ГБ
        
    - `/var/log` + `/var/log/audit` — не менее 10 ГБ
        
    - `swap` — минимум 1 ГБ (или 10% от ОЗУ)
        
    - Остальное в LVM-группу под `/`
        
4. Назначение хостнейма.
    
5. Настройка сетевого интерфейса (только один активный!).
    
6. Установка завершится перезагрузкой.
    

---

## 3. Подготовка к установке РЕД Виртуализации (время: ~1 час)

### 3.1 Настройка хранилища

- **Типы хранилищ:** NFS, iSCSI, GlusterFS (выбор зависит от вашей архитектуры).
    
- **Минимальные требования для hosted-engine storage domain:**
    
    - Тип: общий (shared)
        
    - Размер: от 74 ГБ
        
    - UID:GID: `36:36`, права доступа `0755`
        

### 3.2 Установка необходимых пакетов

```bash
/путь-к-iso/install.sh
```

### 3.3 Настройка файервола

Порты, которые должны быть открыты (Engine):

- TCP: `443`, `54321`, `54322`, `6100`, `2222`
    
- UDP: `123`, `53`


---

## 4. Установка РЕД Виртуализации

### 4.1 Для первого хоста в кластере (время: до 1.5 часа)

> Используется режим **Hosted Engine**  
> Требуется подготовленное хранилище, DNS и SSH-доступ

Команда запуска:

```bash
hosted-engine --deploy --ansible-debug --log=he-deploy.log
ovirt-hosted-engine-setup
```

Рекомендации:

- Укажите fqdn вида host1.local`
    
- IP адрес не должен пересекаться с DHCP
    
- Образ ISO Engine должен быть доступен на локальном или NFS-томе
    
- После установки – проверьте статус:
    

```bash
hosted-engine --vm-status
```

Проблемы при установке? Используйте `journalctl -xe` и анализируйте `he-deploy.log`.

### 4.2 Для второго и последующих хостов (время: до 1 часа на хост)

1. Установите те же пакеты `redvirt-release`, `vdsm`, `cockpit-ovirt`, `ovirt-host`
    
2. Выполните подключение к существующему Engine

3. После добавления – статус должен быть «Active»:
    

```bash
hosted-engine --vm-status
```

---

## Примечания

- Используйте `cockpit` для начального мониторинга: [https://yourhost:9090](https://yourhost:9090/)
    
- DNS должен быть внешним. Engine **не должен** быть DNS-сервером.
    
- Запрещено использовать FQDN, неразрешимые из DNS.

---

## Время суммарного внедрения (типовой случай)

| Этап                         | Время       |
| ---------------------------- | ----------- |
| Подготовка сервера           | 30 мин      |
| Установка ОС                 | 30 мин      |
| Подготовка к установке РВ    | 1 час       |
| Установка первого хоста      | до 1.5 часа |
| Установка последующих хостов | до 1 час    |
| Всего                        | 4-4.5 часов |

---

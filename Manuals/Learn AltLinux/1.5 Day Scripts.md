#learn #linux #alt #bash
Вот решение задания 3.1 с подробными комментариями:

Основной сценарий (base3.sh):

#!/bin/sh
# Сценарий создания групп пользователей
## Лабораторная работа № 3

## Создание групп
```bash
groupadd group1
groupadd group2
```

## Создание пользователей
```bash
adduser user1
adduser user2
adduser user3
```

## Добавление пользователей в группы
```bash
gpasswd -a user1 group1
gpasswd -a user2 group1
gpasswd -a user2 group2
gpasswd -a user3 group2
```

## Вывод информации о пользователях и группах
```sh
for i in `seq 1 3`; do
    echo "Пользователь user$i"
    id user$i
done
```

## Создание каталогов
`mkdir /srv/dir1 /srv/dir2`

## Установка прав доступа к каталогам
```bash
chgrp group1 /srv/dir1
chgrp group2 /srv/dir2
chmod 2775 /srv/dir1 /srv/dir2
```

## Проверка прав на каталоги
`ls -la /srv`
Тестовый сценарий (test3.sh):
>
#!/bin/sh
# Сценарий проверки прав пользователей
# Лабораторная работа № 3

# Пользователь user2 создает файл в dir1 и dir2

> [!bash]
> su -l user2 -c 
> cd /srv/dir1
> touch file_u2d1
> echo "$(whoami) создал(а) файл в каталоге $(pwd)"
> cd /srv/dir2
> touch file_u2d2
> echo "$(whoami) создал(а) файл в каталоге $(pwd)"


# Пользователь user1 перемещает файлы из dir1 и dir2
su -l user1 -c '
cd /srv/dir1/
mv /srv/dir1/file_u2d1 /srv/dir1/file_u1d1
cd /srv/dir2/
mv /srv/dir2/file_u2d2 /srv/dir2/file_u1d2
'
Обнуляющий сценарий (reset3.sh):
>
#!/bin/sh
# Сценарий удаления файлов, групп и пользователей
# Лабораторная работа № 3

# Удаление каталогов и файлов
rm -rf /srv/dir1 /srv/dir2

# Удаление пользователей
userdel -r user1
userdel -r user2
userdel -r user3

# Удаление групп
groupdel group1
groupdel group2
Запуск сценариев:
Для каждого сценария установите права на выполнение:
>
chmod +x base3.sh test3.sh reset3.sh
Запустите основной сценарий с правами суперпользователя:
>
sudo ./base3.sh
Запустите тестовый сценарий:
>
./test3.sh
Запустите обнуляющий сценарий с правами суперпользователя после завершения тестирования:
>
sudo ./reset3.sh
Дополнительное задание (3.2):
Вам нужно разработать три аналогичных сценария, но с именами пользователей и названиями групп в качестве параметров. Добавьте проверку количества передаваемых параметров.

User
Сделай на основе 3.1  дополнительное задание (3.2)
ChatGPT
Хорошо, давайте создадим три сценария на основе основного сценария из задания 3.1, но с возможностью передачи имен пользователей и названий групп в качестве параметров. Также мы добавим проверку количества передаваемых параметров.

Сценарий 3.2.1 (create_users_groups.sh):
>
#!/bin/sh
# Сценарий создания пользователей и групп
# Лабораторная работа № 3.2

# Проверка количества переданных параметров
if [ "$#" -ne 6 ]; then
    echo "Использование: $0 <group1> <group2> <user1> <user2> <user3>"
    exit 1
fi

group1=$1
group2=$2
user1=$3
user2=$4
user3=$5

# Создание групп
groupadd $group1
groupadd $group2

# Создание пользователей
adduser $user1
adduser $user2
adduser $user3

# Добавление пользователей в группы
gpasswd -a $user1 $group1
gpasswd -a $user2 $group1
gpasswd -a $user2 $group2
gpasswd -a $user3 $group2

# Вывод информации о пользователях и группах
for user in $user1 $user2 $user3; do
    echo "Пользователь $user"
    id $user
done

Разберем данный сценарий подробно:

Объявление интерпретатора:
>
#!/bin/sh
Эта строка указывает на то, что интерпретатором для выполнения сценария будет обычный оболочка командной строки (shell).

Комментарий с описанием сценария:
>
# Сценарий создания пользователей и групп
# Лабораторная работа № 3.2
Этот блок содержит комментарии, которые описывают назначение и цель данного сценария.

Проверка количества переданных параметров:
>
if [ "$#" -ne 6 ]; then
    echo "Использование: $0 <group1> <group2> <user1> <user2> <user3>"
    exit 1
fi
Этот блок проверяет, что количество переданных параметров соответствует ожидаемому (в данном случае, 6 параметров). Если количество параметров не совпадает, выводится сообщение об использовании скрипта и происходит выход из сценария с кодом ошибки 1.

Присвоение значений параметров:
>
group1=$1
group2=$2
user1=$3
user2=$4
user3=$5
Эти строки присваивают значения переданных аргументов переменным для дальнейшего использования в сценарии.

Создание групп и пользователей:
>
groupadd $group1
groupadd $group2
adduser $user1
adduser $user2
adduser $user3
Здесь используются команды groupadd для создания групп и adduser для создания пользователей на основе переданных аргументов.

Добавление пользователей в группы:
>
gpasswd -a $user1 $group1
gpasswd -a $user2 $group1
gpasswd -a $user2 $group2
gpasswd -a $user3 $group2
Команды gpasswd -a добавляют пользователей в указанные группы.

Вывод информации о пользователях и группах:

```sh
for user in $user1 $user2 $user3; do
    echo "Пользователь $user"
    id $user
done
```
Этот блок использует цикл for, чтобы пройти по каждому из пользователей и вывести информацию о них с помощью команды id.

Это подробный разбор сценария создания пользователей и групп.


Сценарий 3.2.2 (test_permissions.sh):
>
#!/bin/sh
# Сценарий проверки прав доступа к файлам
# Лабораторная работа № 3.2

# Проверка количества переданных параметров
if [ "$#" -ne 2 ]; then
    echo "Использование: $0 <user1> <user2>"
    exit 1
fi

user1=$1
user2=$2

# Пользователь user2 создает файлы
su -l $user2 -c '
cd /srv/dir1
touch file_u2d1
echo "$(whoami) создал(а) файл в каталоге $(pwd)"
cd /srv/dir2
touch file_u2d2
echo "$(whoami) создал(а) файл в каталоге $(pwd)"
'

# Пользователь user1 перемещает файлы
su -l $user1 -c '
cd /srv/dir1/
mv /srv/dir1/file_u2d1 /srv/dir1/file_u1d1
cd /srv/dir2/
mv /srv/dir2/file_u2d2 /srv/dir2/file_u1d2
'
Сценарий 3.2.3 (cleanup.sh):
>
#!/bin/sh
# Сценарий очистки после выполнения
# Лабораторная работа № 3.2

# Удаление каталогов и файлов
rm -rf /srv/dir1 /srv/dir2

# Удаление пользователей
for user in $user1 $user2 $user3; do
    userdel -r $user
done

# Удаление групп
groupdel $group1
groupdel $group2
Запуск сценариев:
Для каждого сценария установите права на выполнение:
>
chmod +x create_users_groups.sh test_permissions.sh cleanup.sh
Запустите сценарий создания пользователей и групп с передачей необходимых параметров:
>
./create_users_groups.sh group1 group2 user1 user2 user3
Запустите тестовый сценарий с передачей имен пользователей:
>
./test_permissions.sh user1 user2
После окончания тестирования запустите сценарий очистки:
>
./cleanup.sh
Это должно обеспечить создание пользователей, назначение их в группы, проверку прав доступа к файлам и очистку после завершения.
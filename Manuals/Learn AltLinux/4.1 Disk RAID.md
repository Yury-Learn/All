#linux #bash #raid #disk
Для выполнения этих задач вам потребуется виртуальная машина, настроенная в среде Oracle VM VirtualBox, и установленная операционная система Linux. В качестве примера, я буду использовать CentOS, но вы можете выбрать любой другой дистрибутив Linux по вашему усмотрению.

Прежде чем начать, убедитесь, что у вас есть доступ к дискам или виртуальным дискам в вашей виртуальной машине, которые вы можете использовать для создания разделов и RAID-массивов.

Давайте начнем.

### Шаг 1: Разбиение диска
Для разбиения диска на соответствующие разделы выполните следующие шаги:

```bash
# Запустите утилиту разбиения диска
sudo fdisk /dev/sda

# Создайте первый раздел размером 5 ГБ
# Введите последовательно следующие команды:
n     (для создания нового раздела)
p     (для создания первичного раздела)
<Enter> (для выбора номера раздела по умолчанию)
<Enter> (для выбора начального сектора по умолчанию)
+5G   (для указания размера раздела в 5 ГБ)
n     (для создания следующего раздела)
p     (для создания первичного раздела)
<Enter> (для выбора номера раздела по умолчанию)
<Enter> (для выбора начального сектора по умолчанию)
+5G   (для указания размера раздела в 5 ГБ)
n     (для создания третьего раздела)
p     (для создания первичного раздела)
<Enter> (для выбора номера раздела по умолчанию)
<Enter> (для выбора начального сектора по умолчанию)
<Enter> (для указания оставшейся части диска)

# Сохраните изменения и выйдите
w
```

### Шаг 2: Создание VG и LV
Теперь мы создадим VG (Volume Group) на двух разделах по 5 ГБ и создадим на нем LV (Logical Volume) размером 8 ГБ.

```bash
# Создание VG
sudo vgcreate myvg /dev/sda1 /dev/sda2

# Создание LV на 8 ГБ
sudo lvcreate -L 8G -n mylv myvg
```

### Шаг 3: Расширение LV
Расширим LV до 10 ГБ:

```bash
# Расширение LV до 10 ГБ
sudo lvextend -L 10G /dev/myvg/mylv

# Обновление размера файловой системы
sudo resize2fs /dev/myvg/mylv
```

### Шаг 4: Создание RAID5
Создадим RAID5 на LV размером 10 ГБ и одном из оставшихся разделов на 10 ГБ.

```bash
# Создание RAID5
sudo mdadm --create --verbose /dev/md0 --level=5 --raid-devices=2 /dev/myvg/mylv /dev/sda3
```

### Шаг 5: Создание ФС и монтирование
Создадим файловую систему ext4 и смонтируем RAID в /mnt/raid:

```bash
# Создание файловой системы ext4
sudo mkfs.ext4 /dev/md0

# Создание точки монтирования
sudo mkdir /mnt/raid

# Монтирование RAID
sudo mount /dev/md0 /mnt/raid
```

### Шаг 6: Симуляция отказа диска и восстановление
Для симуляции отказа одного из дисков на RAID и его восстановления, выполните следующие шаги:

```bash
# Отключение одного из дисков
sudo mdadm --manage /dev/md0 --fail /dev/myvg/mylv

# Удаление отказавшего диска из RAID
sudo mdadm --manage /dev/md0 --remove /dev/myvg/mylv

# Проверка статуса RAID
cat /proc/mdstat

# Вставка нового диска (симулируем замену)
sudo mdadm --manage /dev/md0 --add /dev/sda2

# Проверка статуса RAID после восстановления
cat /proc/mdstat
```

Эти команды создадут и настроят нужные разделы, VG, LV, RAID5, файловую систему и точку монтирования. После выполнения этих шагов, вы сможете продолжить работу с вашим RAID-массивом.
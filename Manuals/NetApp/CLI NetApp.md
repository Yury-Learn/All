---
tags: netapp
---
## Горячие клавиши NetApp DataONTAP

|   |   |
|---|---|
|**Комбинация клавиш**|**Значение**|
|Ctrl + F или стрелка вправо|Переместить курсор вправо на одну позицию|
|Ctrl + B или стрелка влево|Переместить курсор влево на одну позицию|
|Ctrl + A|Переместить курсор в начало строки|
|Ctrl + K|Переместить курсор в конец строки|
|Ctrl + H|Удалить символ слева от курсора|
|Ctrl + U|Удалить строку|
|Ctrl + W|Удалить слово|
|Ctrl + R|повторно вывести строку|
|Ctrl + I|Табуляция (Tab)|
|Ctrl + E (end)|переметить курсор в конец строки|
|Ctrl + P|предыдущая команда|
|Ctrl + N|Следующая команда|
|Ctrl + C|отменить команду|

## Команды управления базовыми настройками СХД

Очень жаль, что командная оболочка не поддерживает автодополнение команд. В будущих версиях это обещают доделать (говорят в режиме Cluster это уже работает, но проверить пока не довелось). Основная команда, которая применяется чаще всего это **help** или “**?**“. Без аргументов выводит **все доступные в системе команды**. Если ввести **команду help** перед другой командой, то будет выведена краткая справка о команде, если ввести после команды и перед одним из параметров команды, то будет выведена краткая справка об использовании параметра. Еще одна очень важная команда помощи – **man**.

- **availtime** – статистика времени работоспособности и доступности системы по протоколам
- **config** – работа с конфигурацией хранилища
    - _dump_ – сохранение
    - _diff_ – сравнение
    - _restore_ – восстановление
    - _clone_ – клонирование на другую ноду
- **date** – как в unix, управление датой (date [-u] [[[CC]yy]mmddhhmm[.ss]])
- **download** –  задать установленный образ DataONTAP в качестве образа по умолчанию при последующей  загрузке
- **environment** – Отображает статус физического окружения (температура полок и шасси системы хранения и др. параметры)
- **halt** – выключение контроллера
- **led_on** _диск_ – подсвечивает диске в хранилище. Очень удобно для визуальной идентификации сбойного диска. (работает только в advanced режиме)
- **led_off** _диск_ – отключение подсвечивания
- **lock status** _-h_ – команда для отображения блокировками файлов (-h группирует вывод по хостам)
- **license** – управление лицензиями
    - _add_ – добавить
    - _delete_ – удалить
    - _show_ – показать
- **options** _parametr_ – основная команда для задания параметров хранилища. Список основных разделов _параметров_ предоставлен [ниже](https://www.k-max.name/netapp/osnovnye-komandy-netapp-dataontap-7-mode/#optn "разделы options").
- **passwd** – обычный юниксовый passwd для управления паролями пользователей
- **priv set** [ _priv-level_ ] – установка уровня привилегий текущей сессии, где _priv-level_ это _admin_ –  ограниченный, _advanced_ – расширенный.
- **reboot** – перегружает контроллер
- **rdfile** _/path/to/file_ – чтение файла. Вместо использования rdfile я предпочитаю монтировать корневой том по nfs и редактировать файлы в Linux.
- **rm** _/vol/volХ/somefile_ – удаление файлов с хранилища (вроде работает только в расширенном режиме)
- **secureadmin** – управление безопасными протоколами управления (SSL n SSH)
    - _setup_ – задание настроек
        - _ssl_ – задание настроек https
        - _ssh_ – задание настроек SSH
- **setup** – скрипт настройки контроллера, работает в виде мастера
- **software** – команда для установки\обновления Data ONTAP
    - _get_ _url_ – загружает на контроллер OS с http сервера
    - _update_ – обновляет OS из загруженного файла
- **stats** – отображение статистики о хранилище.
    - _show vstorage_ – отображение статистики работоспособности VAAI (VMware vStorage APIs for Array Integration)
- **storage** – команда управления адаптерами дисков SAS, SCSI и FC
    - _download shelf_ – загрузить прошивку в дисковую полку
    - _show –_ отображает конфигурацию хранилища
        - _adapter –_ отображает информацию о всех адаптерах (SAS, FC, iSCSI, FCoE), включая сопутствующую информацию о характеристиках
        - _disk_ – отображает текущую информацию о дисках 
            - _-p_ – отображает информацию о primary and secondary paths для дисков
        - _tape_ – отображает информацию о подключенных ленточных библиотеках
    - _stats_ – отображает статистику ленточной библиотеки
- **sysconfig** – различная информация о системе
    - _-a_ – еще более подробный вывод о каждом устройстве I/O
    - _-d_ – физические диски
    - _-r_ – отображает общую информацию о конфигурации RAID (агрегаты, vol, disks, spares, failed…) (aggr status -r и vol status -r)
    - _-v_ – подробный вывод о каждом устройстве I/O
- **sysstat** _int_ – отображение статистики производительности хранилища (CPU, network I/O,  disk I/O…). _int_ указывает интервал вывода статистики (по-умолчанию – 15 сек)
    - _-b_ – отображение статистики FCP совместно со статистикой HA партнера
    - _-f –_ статистика трафика FCP
    - _-s_ отображение суммарной статистики после остановки команды
    - _-u_ отображение расширенной статистики утилизации
- **timezone** – установка и просмотр информации о временной зоне
- **uptime** – классика ) аптайм он и в новой гвинее аптайм
- **useradmin** – управление пользователями, группами, ролями
    - _group_ – управление группами
    - _user_ – управление пользователями
    - _list_ – список
    - _add_ – добавление
    - _role_ – управление ролями
- **version** – отображение версии Ontap
    - _-a_ отображение расширенной информации о версии
- **wrfile** (-_a_) – запись в файл. (опция _-a_ указывает дописать текст в конец файла). Аналог “_cat > filename_” в Linux или “_cat >> filename_” при использовании -a. Вместо использования rdfile\wrfile я предпочитаю монтировать корневой том по nfs и редактировать файлы в Linux. 

## Команды управления сетевой подсистемой DataONTAP

- **dns** – информация о работе [DNS](https://www.k-max.name/category/linux/dns-linux/ "DNS сервер в linux")
    - _info_ –  статистика кэша dns
- **hostname** – отображение и задание имени хоста контроллера (необходимо добавить в /etc/rc, чтобы при перезагрузке имя сохранилось)
- **ifgrp** – управление  interface group (bonding/trunking/teaming)
    - _create_ – создание группы интерфейсов
    - _status_ – показывает статус группы интерфейсов
- **ifconfig** – классическая unix команда для управления сетевыми интерфейсами. Чтобы действия команды сохранялись при перезагрузке, необходимо продублировать команды в /etc/rc
- **ifstat** – показывает статистику сетевых интерфейсов
- **netstat** – отображает сетевую статистику
- **pktt** – трассировщик сетевых пакетов. Аналог [tcpdump в linux](https://www.k-max.name/linux/tcpdump-v-primerax/ "tcpdump в примерах (или шпаргалка по tcpdump)"). На [сайте romx](https://www.k-max.name/netapp/osnovnye-komandy-netapp-dataontap-7-mode/#links "ссылки основные команды netapp") есть хорошая статья о pktt.
- **route** – управление таблицей маршрутизации
- **vlan** – команда для управления конфигураций VLAN интерфейсов

## Команды управления разделам, агрегатами и другими элементами хранилища

![Распределение пространства в Netapp](https://library.netapp.com/ecmdocs/ECMP1368859/html/GUID-641CF5C8-6890-4867-81B6-CA693515771E-low.gif "Распределение пространства в Netapp")

для наглядности

- **aggr** – управление аггрегатами
    - _status_ – статус аггрегата
        - -f отображение дисков/LUN, которые находятся в статусе fail
        - -i Отображает aggregate и тома, содержащиеся на каждом aggregate
        - -m диски, которые в данный момент перемещены в центр обслуживания (maintenance center)
        - -r отображает конфигурацию RAID (дисковые группы, диски, информация о ходе запущенных процессов на дисках (ребилд, обнуление и т.п.), статус диска (spare/parity/dparity))
        - -s Spare диски
        - -S Размер занимаемого пространства агрегатом
    - _create_ – создать аггрегат
    - _add_ – добавить дисков к агрегату
    - _rename_ – переименовать агрегат
    - _offline/online_
    - _destroy_ – уничтожить (требует перевода в offline)
    - _show_space_ – показывает использование пространства на aggreate, WAFL reserve, overheads
- **disk** – управление физическими дисками
    - _show_ – показать информацию по владельцам дисков
        - -n – показать неассоциированные диски (без овнера)
        - -v – показать все имеющиеся диски
        - -a – показать диски, имеющие владельца
    - _assign_  – ассоциировать диск с владельцем – текущим контроллером (по умолчанию, включен параметр disk.auto_assign и каждые 10 мин система проверяет не ассоциированные диски), пример disk assign 0a.00.20 0a.00.21
    - _maint_ –  статус maintenance тестов дисков
        - status
    - _zero spares_ – пописать диски нулями
    - _fail_ – зафэйлить диск насильно (применимо только к используемым в группах дисках)
    - _unfail_ – восстановить диск (только в advanced режиме)
    - _remove_ – подготавливает диск к физическому удалению (если диск ассоциирован – ругнется в лог)
    - _replace_ – замена диска (копирование данных с одного на другой) 
    - _sanitize_ – управление процессами многократной очистки дисков (требует лицензии) 
- **df** – отображение информации о дисковом пространстве (без параметров – отображает место на **томе**)
    - -h в человекопонятном виде
    - -i Отображает использование inode на томе
    - -A Отображает степень занятости **aggregate**
- **maxfiles** – управляет количеством inodes на том
- **ndmpcopy** _/vol/vol0/qtree1 /vol/vol1/qtree1_ – Копирование данных с тома на том, средствами самой системы хранения, при помощи протокола  NDMP
- **qtrees** – управление qtree
    - _create_ – создание
    - _stats_ – отображает количество NFS/CIFS операций
        - -z – сброс счетчика
    - _status_ – отображение статуса qtree
        - -i – отображает ID qtree ресурса, который используется для идентификации (например, в syslog сообщениях)
    - _delete_ – удаляет qtree (только из advanced режима)
- **quota** – вправление дисковыми квотами, согласно записей в файле **/etc/quotas**
    - _on_ _volume_ – включает механизм квоты на разделе
    - _off volume_ – выключает квоты
    - _resize volume_  – изменяет значения квот
    - _report_ – сообщает значения квот и использованного места для всех томов и qtree для каждого пользователя и группы
- **vol** – управление томами
    - _create <volname> <aggrname> <size>_ – создание тома volname на агрегате aggrname с размером size
    - _container  <volname>_ – отображение, в каком агрегате размещен текущий _volname_
    - _options_ – отображение\изменение параметров раздела
    - _size <volname> [+|-]<size>_ – изменение размера раздела volname
    - _status_ – отображение информации о томе
        - -f информации о дисках в статусе fail
        - -F занимаемое пространство данным volume в агрегате (реально занятые/записанные данные)
        - -r – информация о конфигурации RAID в разрезе использования агрегатов, дисковых групп, дисков
        - -s информация о spare дисках
        - -S занимаемое пространство внутри volume (включая, место занимаемое снапшотами/snapshot reserve/, user data, file system metadata, and inodes)
    - _offline/online_ – выключает\включает том. (делает не\доступным для обращений чтения\записи)
    - _destroy_ – уничтожить (требует перевода в offline, восстановлению не подлежит) 

## Команды управления протоколами (SAN\NAS)

- **cifs** – набор команд для управления [протоколом CIFS](https://www.k-max.name/category/linux/samba/ "SAMBA CIFS SMB") 
    - _setup_ – устанавливает и настраивает cifs для использования
    - _shares_ – управление ресурсами cifs
    - _access_ – управляет листами контроля доступа к шарам cifs
- **exportfs** – управление [NFS экспор](https://www.k-max.name/category/linux/nfs/ "Linux NFS протокол")[тами](https://www.k-max.name/category/linux/nfs/ "Linux NFS протокол"), перечисленными  в _/etc/exports_
    - -a – _только_ экспортировать все файловые системы, перечисленные /etc/exports
    - -r – экспортировать и удалить экспорты в соответствии с /etc/exports
- **fcadmin** команда управления адаптерами Fibre Channel
    - _device_map_  Показывает, где какой диск в FC полках
- **fcp** – управление службой, управляющей FCP
    - _nodename_ – отображение WWNN
    - _show initiator_ – отображение информации о FC инициаторе
    - _start_ – запуск
    - _stop_ – остановка
    - _status_ – статус
    - _stats_ – статистика FC target адаптеров
- **ftp stat**  – команда для мониторинга статистики FTP протокола
    - _-z_ – сброс статистики
- **httpstat** – команда просмотра статистики HTTP сервера
- **igroup** – команда для управления initiator group
    - _create_  – создание igroup на контроллере
- **iscsi** – команда управления протоколом iSCSI
    - _initiator show_ – Показывает подключенные к СХД iscsi initiators
- **lun** – Команда для управления LUN
    - _create_ – создает LUN для iscsi или fcp
    - _map_ – устанавливает соответствие LUN для igroup
    - _stats_ – отображает статистику утилизации по каждому lun
        - -o – более расширенный режим отображения статистики
    - _show_ – отображает статус LUN (lun_path, size, online/offline state, shared state)
        - -m  Отображает информацию о lun mapping (lun_path to initiator_group)
- **nfs** – команда управления службой NFS
    - _on_ – включает NFS подсистему
    - _off_ – выключает NFS подсистему
    - _setup_ – запуск мастера установки NFS
    - _status_ – отображение статуса службы
- **nfsstat** – отображение статистики NFS и RPC (Remote Procedure Call) с момента последней перезагрузки или обнуления
    - -d отображает некоторые дополнительные колонки (подробней – в man)
    - -z обнуляет счетчики
    - -l отображает статистику по клиентам
- **nfs_hist** [_-z_] отображает статистику задержек операций nfs (латентность) с последней перезагрузки (-z обнуляет счетчики)
- **sftp** **stat** – команда мониторинга статистики SFTP протокола
    - -z – сброс статистики

##  Команды управления различными технологиями

Не нашел другого названия для раздела ))

- **cf** – управление процессами takeofer и giveback в ~~кластере~~  High Availability паре
    - _status_ – показывает статус кластера
    - _takeover_ – переносит на себя ресурсы кластерного партнера
    - _giveback_ – возвращает ресурсы кластерного партнера
- **snap** – команда управления копиями снапшотов
    - _create <volname> <snapname>_ – создает снапшот  snapname на томе volname
    - _delta_ – информация о пространстве, занимаемом снапшотами
    - _list_ – построчно показывает список всех снэпшотов на томах  или агрегатах (при добавлении опции -A)
    - _reclaimable <volname> <snapname>_ – информация о возможном освобождении пространства при удалении снапшота
    - _sched_  – назначает расписание создания снэпшотов
    - _reserve <volname> <percentage>_ – показывает/устанавливает резервирование места под снэпшоты на томе volname в процентах percentage
- **ndmpcopy** _<src-path> <dst-path>_ – запускает передачу дерева файловой системы с src-path в dst-path
- **ndmpd** – управление службой ndmp
    - _status_ – показывает статус ndmpd
    - _killall_ – прерывает все процессы ndmpd
- **snapmirror** – команда для управления SnapMirror. Зеркалирование томов и qtree
    - _abort_  _destination_ – Остановить текущие синхронизации с  _destination_
    - _initialize_ – инициализирует первоначальную репликацию snapmirror
    - _update_ – для асинхронной репликации – обновляет вручную реплику snapmirror, для синхронной репликации – на source создается снапшот, который становится так же доступен на _destination_
    - _resync_ – ресинхронизация сломанных зеркал snapmirror
    - _quiesce_ _destination_ – завершает текущие синхронизации и приостанавливает связь реплик snapmirror, переводит синхронные синхронизации в асинхронные – приостанавливает.
    - _break_ – разбивает установленные отношения репликации snapmirror и переводит _destination_ том в режим read\write
    - _status_ – показывает статус snapmirror
-  **vfiler** – команда для управления виртуальными хранилищами Virtual Filers (vfilers)

## Разделы команды options

- autosupport.* – настройка автосуппорта
- cf.* – параметры HA конфигурации
- cifs.* – параметры протокола CIFS
- fpolicy.* – параметры File Polycy
- ftpd.* – управление FTP службой
- httpd.* – опции управление службой HTTPD
- interface.blocked.* – блокирование работы протоколов на интерфейсах
- nfs.* – параметры NFS
- sftp.* – опции управления STFP протоколом
- tftpd.* – управление службой TFTP
- timed.* – время по NTP (настройка демона timed)
- telnet.* – параметры telnet доступа
- webdav.* – опции конфигурирования WebDAV доступа

## Основные конфигурационные файлы Netapp

- **/etc/*.lastgood** – файл, имеющий конфигурацию при последней удачной модификации
- **/etc/*.default** – файлы, содержащие конфигурацию по умолчанию
- **/etc/*.bak** – файлы, содержащие резервную копию после глобальных изменений (например, запуск setup)
- **/etc/ad** – каталог для кэширования GPO скриптов, когда на хранилище задействован CIFS с подключением к AD
- **/etc/cifs_homedir.cfg** – файл сопоставления домашних каталогв пользователей
- **/etc/ftpusers** – файл для блокировки пользователей для доступа по FTP
- **/etc/hosts** – [классический](https://www.k-max.name/linux/fajlovaya-sistema-linux-i-struktura-katalogov/ "Файловая система Linux и структура каталогов") файл hosts (текстовый файл, содержащий базу данных доменных имен и используемый при их трансляции в сетевые адреса узлов)
- **/etc/log/httpd.log** – файлы логов HTTP
- **/etc/log/ftp.*** – файлы логов FTP и HTTP служб
- **/etc/log/sftp.cmd.*** – файл логов SFTP (появляются только после включения sftp.log_enable)
- **/etc/messages** – файл размещения логов [службы сислог](https://www.k-max.name/category/linux/syslog-linux/ "syslog")
- **/etc/registry** – Файл, хранящий настройки, заданные с помощью команды options (прямо таки название намекает…так и хочется запустить regedit)
- **/etc/registry.bck,.lastlog,.default** – файлы, содержащие базовую конфигурацию в разных версиях
- **/etc/qual_devices** – список поддерживаемых HDD (в 8.2 я такого не нашел, хотя в man о нем имеется упоминание)
- **/etc/rc** – классический rc файл, как во FreeBSD. Некоторые команды для исполнения при загрузке необходимо записывать в него вручную  (такие как ifconfig, ifgroup, vlan …), некоторые команды при выполнении в консоли автоматом туда добавляются (например options dns.enable off автоматом туда прописался). Administration guide рекомендует использовать следующий порядок команд в файле:

hostname system_name
ifgrp commands
vlan commands
ifconfig commands
vfiler commands
route commands
[any other commands]

- **/etc/serialnum** – файл с инфой о серийном номере (?)
- **/etc/sshd/ssh_host_rsa_key** и **ssh_host_dsa_key** RSA и DSA ключи шифрования.
- **/etc/nsswitch.conf** – типичный файл настройки Neme Service Switch
- **/etc/quotas** – описание квот/лимитов для различных объектов хранилища
- **/etc/syslog.conf** – по умолчанию отсутствует. Умолчанительнй конфиг смотреть или в man или в system manager. Для бОльшей информации смотрите System Administration Guide. По умолчанию, файл отсутствует. Рядом лежит пример _/etc/syslog.conf.simple_. Создавать свой либо руками, либо через систем манаджер.
- **/etc/usermap.cfg** – файл маппинга Windows и UNIX пользователей
- **/etc/zoneinfo** – таймзоны
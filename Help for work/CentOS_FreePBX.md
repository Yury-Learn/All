1. Устанавливаем готовый образ ОС + FreePBX. 
2. Подключаемся к WEB морде (через VGA можем узнать данные: ip)
3. web adress: http://ipadress/admin
4. Заходим  Admin - Systems Admin - Activation
 
 Жмем Activate. Следуем инструкции. (указываем потчу, пароль, номер телефона и местоположение сервера)

5. Настройка SIP 
### Settings - Asterisk Sip Settings
	*файл конфигурации лежит /etc/asterisk/sip_nat.conf*
    Allow Anonymous inbound SIP Calls - no
    Local Networks - 192.168.10.0 / 24 
    RTP Ranges - по умолчанию (10.000 - 20.000)
    Strict RTP - желательно не включать
    Codecs - приоритет выбираем исходя от провайдера и телефонов (alaw, ulaw, gsm и т.д.)


6. Настройка NAT в FreePBX (если есть проблема односторонней слышимости, или обрыв звонка спустя несколько секунд)

##	Asterisk SIP Settings - Chan SIP Settings

	NAT - YES
	IP Configuration - Static IP
	Override External IP - Вводим внешний адресс
	Reinvite Behavior - No
		*Обязательно укажите в настройках Local Networks в предыдущей вкладке вашу локальную подсеть. Помимо этого, пробросьте на вашем маршрутизаторе порт 5060 и диапазон портов из параметра RTP Ranges, по умолчанию равный 10000-20000*


7. Настройка сетевых параметров FreePBX

Есть три важных пункта данной настройки:

Настроить статический IP – адрес для сервера
Настроить DNS
Настроить временную зону
Перейдем к настройке IP. Для этого, перейдите во вкладку 
### Admin → System Admin→ Network Settings

Здесь мы настраиваем следующие опции:

Network Interface - сетевой интерфейс, то есть конкретная сетевая карта (NIC)
IP Assignment - выберите Static чтобы настроить статический IP - адрес
Static IP - введите IP – адрес сервера
Netmask - маска сети
Gateway - шлюз по умолчанию
Start Automatically - старт при загрузке сервера

### Далее, переходим к настройке DNS. Для этого переходим в боковом меню навигации к пункту DNS. Здесь просто указываем адрес DNS сервера, например 8.8.8.8

### Идем дальше. Теперь настроим временную зону, перейдя в боковом меню навигации в пункт Time Zone. В данном примере, наш сервер располагается в Москве

### Настроим уведомления нашего сервера Asterisk, при таких сбоях, как например малое дисковое пространство или сбой в работе RAID массива

8. Конфигурация системы безопасности

В Asterisk встроена система обнаружения вторжений – Fail2Ban. Для настройки системы перейдите во вкладку Admin → System Admin→ Intrusion Detection

Система гибкая, и , порой реагирует когда не нужно :) Поэтому, советуем заранее вносить в Whitelist перечень нужных IP – адресов, таких как IP SIP – прокси, адреса шлюзов, например FXS. Порой, бывает так, что в бан попадает IP – адрес FXS шлюза, к которому подключены все офисные аналоговые телефоны.

Status - мы рекомендуем всегда контролировать состояние Fail2Ban, чтобы статус был running
Intrusion Detection - в данном пункте можно остановить и перезапустить службу.
Ban Time - время в секундах, которое IP – адрес будет находиться в статусе блокировки
Max Retry - количество попыток подключения к АТС, которое пользователь может осуществить в течение Find Time.
Find Time - время, в течение которого у пользователя есть Max Retry попыток подключения к системе.
E-mail: - адрес электронной почты, на которую будут отправляться уведомления о внесении нового IP – адреса в бан.
Whitelist - список заранее внесенных IP – адресов, которым доверяет администратор.

9. Настройка внутренних номеров

Для настройки телефонных аппаратов и создания внутренних номеров перейдите во вкладку Applications → Extensions. Процесс создания внутренних номеров (Extension) мы описали в статье по ссылке ниже:
Создание Extensions

10. Настройка SIP - транка

Подключение к провайдеру является важнейшим этапом в настройке вашего сервера IP - АТС Asterisk. Именно настройки провайдера, позволят нашим пользователям совершать исходящие, и принимать входящие вызовы. Для настройки SIP – транка перейдите во вкладку Connectivity → Trunks. Процесс создания SIP - транка подробно расписан в статье по ссылке ниже:
Создание SIP - транка

11. Настройка маршрутизации

После того, как мы настроили внутренние номера и SIP – транки для подключения к провайдеру, нам необходимо настроить маршрутизацию вызова. В рамках данной настройки, мы будем учить наш сервер Asterisk как обрабатывать входящий и исходящие вызовы. Connectivity → Inbound/Outbound Routes. Данный процесс мы подробно описали в статье по ссылке ниже:
Настройка маршрутизации вызовов

12. Настройка голосового меню

Так как наш Астериск будет установлен в небольшой компании, мы планируем сделать голосовое меню, в котором будем помогать пользователям быстрее связаться с нужным человеком. Настройка голосового меню (IVR), регламентируется в модуле IVR, консоль конфигурации которого располагается во вкладке Applications → IVR. Настройку вы можете найти по ссылке ниже
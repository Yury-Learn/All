#iptables #debian #linux 

 - –í–æ—Ç –ø—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª –¥–ª—è –≤–µ–± —Å–µ—Ä–≤–µ—Ä–∞, –≥–¥–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≤—Å—ë, —á—Ç–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —è–≤–Ω–æ (22,80,443 –ø–æ—Ä—Ç—ã). –ü–æ–∫–∞–∑—ã–≤–∞—é –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–∞. 
 - ### default rules
```
iptables -P INPUT DROP
iptables -P INPUT DROP
iptables -P FORWARD DROP
```
### allow localhost
```
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT
```
### allow established
```
iptables -A INPUT -p all -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -p all -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -p all -m state --state ESTABLISHED,RELATED -j ACCEPT
```
### allow ping
```
iptables -A INPUT -p icmp --icmp-type echo-reply -j ACCEPT
iptables -A INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT
iptables -A INPUT -p icmp --icmp-type time-exceeded -j ACCEPT
iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
```
### allow server connections
`iptables -A OUTPUT -o ens3 -j ACCEPT`
### allow ssh, www
```
iptables -A INPUT -i ens3 -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -i ens3 -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -i ens3 -p tcp --dport 443 -j ACCEPT
```
### logging
```
iptables -N block_in
iptables -N block_out
iptables -N block_fw
iptables -A INPUT -j block_in
iptables -A OUTPUT -j block_out
iptables -A FORWARD -j block_fw
iptables -A block_in -j LOG --log-level info --log-prefix "-IN-BLOCK-"
iptables -A block_in -j DROP
iptables -A block_out -j LOG --log-level info --log-prefix "-OUT-BLOCK-"
iptables -A block_out -j DROP
iptables -A block_fw -j LOG --log-level info --log-prefix "-FW-BLOCK-"
iptables -A block_fw -j DROP
```
- –° —Ç–∞–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤ –ª–æ–≥ –±—É–¥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ü–µ–ø–æ—á–∫–∞—Ö. –í –æ–±—ã—á–Ω–æ–π —Ä–∞–±–æ—Ç–µ —ç—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ. –ù–æ –µ—Å–ª–∏ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –±–æ–ª—å—à–æ–π, –±—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –∫—É–¥–∞-—Ç–æ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –∞ –ø–∞–∫–µ—Ç—ã –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –Ω–µ —Ö–æ–¥—è—Ç. –¢–∞–∫–æ–µ –±—ã–≤–∞–µ—Ç –Ω–µ—Ä–µ–¥–∫–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö VPN  —Ç—É–Ω–Ω–µ–ª–µ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Ç—Ä–∞—Ñ–∏–∫–æ–º —É–ø—Ä–∞–≤–ª—è—Ç—å. –î–æ–±–∞–≤–ª—è–µ—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ, –Ω–µ—Ç –ª–∏ –≤–∞—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö. –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ –ø–æ–º–æ–≥–∞—é—Ç –±—ã—Å—Ç—Ä–æ –≥—Ä–µ–ø–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏. –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, —Ä–∞–∑–±–∏—Ä–∞–µ—Ç–µ—Å—å, –ø–æ—á–µ–º—É –æ–Ω–∏ —Ç–∞–º –æ–∫–∞–∑–∞–ª–∏—Å—å. –í–Ω–æ—Å–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª–∞. –ö–æ–≥–¥–∞ –≤—Å—ë –∑–∞–∫–æ–Ω—á–∏—Ç–µ, –ø—Ä–∞–≤–∏–ª–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —É–¥–∞–ª—è–µ—Ç–µ, —á—Ç–æ–±—ã –Ω–µ —Å–æ–±–∏—Ä–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –ª–æ–≥–∏.
### Make sure not to drop established connections.
`iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT`
### Allow SSH.
`iptables -A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT`
###  Allow PostgreSQL.
`iptables -A INPUT -p tcp -m state --state NEW --dport 5432 -j ACCEPT`
### Allow all outbound, drop everything else inbound.
```
iptables -A OUTPUT -j ACCEPT
iptables -A INPUT -j DROP
iptables -A FORWARD -j DROP
```
### Only allow access to PostgreSQL port from the local subnet.
`iptables -A INPUT -p tcp -m state --state NEW --dport 5432 -s 192.168.1.0/24 -j ACCEPT`

---

### –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–´–• –ü–†–ê–í–ò–õ
-  –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É iptables -A. –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç IP-–∞–¥—Ä–µ—Å–∞ 192.168.0.100, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:
`iptables -A INPUT -s 192.168.0.100 -j DROP` 
- –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ —Å—Ç—Ä–æ–∫—É *5* —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º tcp –ø–æ—Ä—Ç 10051
`iptables -I INPUT 5 -p tcp --dport 10051 -j ACCEPT`


–í —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ -A INPUT –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ —Ü–µ–ø–æ—á–∫—É INPUT, -s 192.168.0.100 –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π IP-–∞–¥—Ä–µ—Å, –∞ -j DROP —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–∞–∫–µ—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç—Ç–æ–º—É –ø—Ä–∞–≤–∏–ª—É, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–±—Ä–æ—à–µ–Ω—ã.
### –£–î–ê–õ–ï–ù–ò–ï –ü–†–ê–í–ò–õ
-  –ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ, –≤–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –µ–≥–æ –Ω–æ–º–µ—Ä –≤ —Ü–µ–ø–æ—á–∫–µ. –í—ã –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –ø—Ä–∞–≤–∏–ª, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É iptables -L --line-numbers. –ó–∞—Ç–µ–º –≤—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É iptables -D –∏ –Ω–æ–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ —Ü–µ–ø–æ—á–∫–µ INPUT, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:-->
```
iptables -L --line-numbers
iptables -D INPUT 1 
```
---
### –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–ï–§–û–õ–¢–ù–û–ì–û –ü–û–õ–ò–¢–ò–ö–ò
-  –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è —Ü–µ–ø–æ—á–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É iptables -P. –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:
`iptables -P INPUT DROP` 
---
### –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ü–†–ê–í–ò–õ
-  –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø—Ä–∞–≤–∏–ª–∞ iptables –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã. –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É iptables-save. –≠—Ç–æ –≤—ã–≤–µ–¥–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã iptables-restore. 
`iptables-save > /path/to/iptables/rules` 

- –ó–∞—Ç–µ–º, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:
`iptables-restore < /path/to/iptables/rules` 
### –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ iptables
- –ó–∞–ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–Ω–æ—Å–∏–º—ã–µ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã iptables –∏—Å—á–µ–∑–Ω—É—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞, –µ—Å–ª–∏ –∏—Ö –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. üòâ
–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—è–ª–∫—É: 
`apt install netfilter-persistent iptables-persistent`
–¥–∞–ª–µ–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏–º –∏—Ö –≤ –Ω–∞—à –º–µ–∂—Å–µ—Ç–µ–≤–æ–π —ç–∫—Ä–∞–Ω
`netfilter-persistent save`

---

**1. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Iptables**
 - **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP-–∞–¥—Ä–µ—Å–∞**
–ß—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:
`iptables -A INPUT -s 192.168.0.100 -j DROP` 
- **–û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞ –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞**
–ß—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É: 
`iptables -A INPUT -p tcp --dport 80 -j ACCEPT` 
 –í —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ -p tcp —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ TCP), --dport 80 —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ 80), –∞ -j ACCEPT —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–∞–∫–µ—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç—Ç–æ–º—É –ø—Ä–∞–≤–∏–ª—É, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–Ω—è—Ç—ã.
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–µ–∂—Å–µ—Ç–µ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞**
–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å iptables –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ –º–µ–∂—Å–µ—Ç–µ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤–µ—Å—å –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã –∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã.-->
```
iptables -A OUTPUT -j ACCEPT iptables -A INPUT -p tcp --dport 22 -j ACCEPT iptables -A INPUT -p tcp --dport 80 -j ACCEPT iptables -A INPUT -p tcp --dport 443 -j ACCEPT iptables -P INPUT DROP 
```
–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ —Ä–∞–∑—Ä–µ—à–µ–Ω –≤–µ—Å—å –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫, –∞ –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Ä—Ç—ã 22 (SSH), 80 (HTTP) –∏ 443 (HTTPS). –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è. 
####  –¢—É—Ç –ø–æ–∂–∞–ª—É–π —Å—Ç–æ–∏—Ç –µ—â—ë –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ —Å–∞–º–∏ –ø—Ä–∞–≤–∏–ª–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏ 
`sudo iptables -A ...`
-A —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Ç Append –∏ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Å–∞–º—ã–π –Ω–∏–∑ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª.
–õ–∏–±–æ 
`sudo iptables -I ...`
-I —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –æ—Ç Insert –∏ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–∞–º—ã–π –≤–µ—Ä—Ö –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.
–ü–æ—á–µ–º—É —ç—Ç–æ —Ç–∞–∫ –≤–∞–∂–Ω–æ? –î–µ–ª–æ –≤ —Ç–æ–º —á—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç Iptables - first match win. –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Ñ–∞–µ—Ä–≤–æ–ª –±—É–¥–µ—Ç –∏–¥—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø–æ –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º —Å–≤–µ—Ä—Ö—É - –≤–Ω–∏–∑, –¥–æ —Ç–µ—Ö –ø–æ—Ä –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ. –ü–æ—ç—Ç–æ–º—É –ª—É—á—à–µ —Å—Ç–∞–≤—å—Ç–µ –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤—ã—à–µ.
–¢–∞–∫–∂–µ —Å–ª–µ–¥—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—É: generic –ø—Ä–∞–≤–∏–ª–∞, —Ç–µ –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —É—Ç–æ—á–Ω–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä 
*sudo iptables -A INPUT -i lo -j ACCEPT* —Å–ª–µ–¥—É–µ—Ç –ø–æ–º–µ—â–∞—Ç—å –Ω–∏–∂–µ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª. –°—Ç–∞—Ç–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–µ–º —á—Ç–æ —Ç–∞–º —è–≤–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω ip –ª–∏–±–æ –ø–æ—Ä—Ç.
#### –£–¥–∞–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ iptables
- –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —É–¥–∞–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ –Ω–æ–º–µ—Ä—É. –î–ª—è —ç—Ç–æ–≥–æ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–º–µ—Å—Ç–µ —Å –∏—Ö –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º 
`sudo iptables -L -n --line-numbers`
 - –ù–∞—Ö–æ–¥–∏–º –Ω–æ–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞ –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–∏–º —É–¥–∞–ª–∏—Ç—å. –ù–æ–º–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º —Å—Ç–æ–ª–±—Ü–µ. –ò —É–¥–∞–ª—è–µ–º —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ç–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ 
*sudo iptables [-t —Ç–∞–±–ª–∏—Ü–∞] -D —Ü–µ–ø–æ—á–∫–∞ –Ω–æ–º–µ—Ä_–ø—Ä–∞–≤–∏–ª–∞*
–ù–∞–ø—Ä–∏–º–µ—Ä
`sudo iptables -t filter -D INPUT 2`
–£–¥–∞–ª–∏—Ç –ø—Ä–∞–≤–∏–ª–æ ‚Ññ2 –≤ —Ç–∞–±–ª–∏—Ü–µ filter —Ü–µ–ø–æ—á–∫–∏ INPUT 

- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª - –ø–æ –¥–µ–π—Å—Ç–≤–∏—é. –ì—Ä—É–±–æ –≥–æ–≤–æ—Ä—è –Ω–∞–¥–æ –≤–≤–µ—Å—Ç–∏ –∫—É—Å–æ–∫ —Ç–æ–≥–æ —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ. –õ–æ–≥–∏–∫–∞ —Ç—É—Ç —Ç–∞–∫–∞—è
*sudo iptables [-t —Ç–∞–±–ª–∏—Ü–∞] -D —Ü–µ–ø–æ—á–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏_–ø—Ä–∞–≤–∏–ª–∞*
–ö —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º –ø—Ä–∞–≤–∏–ª–∞ –º–æ–∂–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç—Å—è IP –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –ª–∏–±–æ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–Ω–æ –µ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç (–ø–æ—Ä—Ç, IP –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, –ø—Ä–æ—Ç–æ–∫–æ–ª –∏ –¥—Ä.) –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, -j ACCEPT.
–ù–∞–ø—Ä–∏–º–µ—Ä
`sudo iptables -t filter -D INPUT -s 192.168.10.0/24 -j ACCEPT`
#### –û—á–∏—Å—Ç–∫–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ —Ü–µ–ø–æ—á–µ–∫

- –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω—É–ª—è—Ç—å –Ω–µ —Å–∞–º–∏ –ø—Ä–∞–≤–∏–ª–∞ iptables, –∞ —Ç–æ–ª—å–∫–æ –∏—Ö —Å—á—ë—Ç—á–∏–∫–∏ —Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ. –ß—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ü–µ–ø–æ—á–µ–∫ –∏ –ø—Ä–∞–≤–∏–ª, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ü–∏—é -Z –æ—Ç–¥–µ–ª—å–Ω–æ: 
`sudo iptables --zero`
 - –ß—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ü–∏—é -Z –∏ —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏: -->
sudo iptables --zero INPUT
- –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è —Ü–µ–ø–æ—á–∫–∏ –∏ –Ω–æ–º–µ—Ä –ø—Ä–∞–≤–∏–ª–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ü–µ–ø–æ—á–∫–µ INPUT:
`sudo iptables --zero INPUT 1`

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª iptables
–ï—â—ë —Ä–∞–∑ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞ —Å –ø–æ–º–æ—â—å—é
```
sudo iptables -L -v
iptables basic block added rules
```

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª–∞ –∂–∏–≤—É—Ç –¥–æ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º —Å–µ—Ä–≤–µ—Ä 
-  –ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Å–æ–∑–¥–∞—ë–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
```sh
sudo mkdir -p /scripts/iptables
```

- –î–µ–ª–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ —é–∑–µ—Ä–∞ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–µ root) –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```sh
sudo chown -R $USER:$USER /scripts/iptables
```

- –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –Ω–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞ –≤ —ç—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é -->
```sh
sudo iptables-save > /scripts/iptables/iptables-rules
```

- –¢–µ–ø–µ—Ä—å –∂–µ –º—ã —Ö–æ—Ç–∏–º —á—Ç–æ–±—ã –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≥—Ä—É–∑–∏–ª–∏—Å—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã, –ø–æ—ç—Ç–æ–º—É —Å–æ–∑–¥–∞–¥–∏–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç 
```sh
sudo nano /etc/network/if-pre-up.d/iptables
```

- –° —Ç–∞–∫–∏–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º
```
#!/bin/sh
iptables-restore < /scripts/iptables/iptables-rules
exit 0
```
–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º 
`chmod +x /etc/network/if-pre-up.d/iptables`
–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ –Ω–∞—à–∏ –ø—Ä–∞–≤–∏–ª–∞ –æ—Å—Ç–∞–Ω—É—Ç—Å—è. 
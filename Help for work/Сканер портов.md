#nmap #bash #linux #ip #ss   #network  
**Основы**. 
Для обнаружения открытых портов удалённых систем используйте команду 
```sh
nmap -sT -O localhost 
```
- для проверки TCP-портов и 
```sh
nmap -sU localhost 
```
- для проверки UDP-портов

```sh
sudo netstat -tulpn
```
---
####  1. Как пользоваться Nmap для сканирования портов в Linux
Дальше рассмотрим примеры nmap. Сначала давайте рассмотрим как найти все подключенные к сети устройства, для этого достаточно использовать опцию -sL и указать маску нашей сети. в моем случае это 192.168.1.1/24. Маску вашей локальной сети вы можете найти, выполнив команду:
```sh
ip addr show
```

Команда на сканирование сети nmap будет выглядеть вот так:
```sh
nmap -sL 192.168.1.1/24
```

Иногда это сканирование может не дать никаких результатов, потому что некоторые операционные системы имеют защиту от сканирования портов. Но это можно обойти, просто использовав для сканирования ping всех ip адресов сети, для этого есть опция -sn:
```sh
nmap -sn 192.168.1.1/24
```
теперь программа обнаружила активные устройства в сети.

Дальше мы можем сканировать порты nmap для нужного узла запустив утилиту без опций:
```sh
 sudo nmap 192.168.1.1
```

Чтобы узнать более подробную информацию о машине и запущенных на ней сервисах вы можете использовать опцию -sV. Утилита подключится к каждому порту и определит всю доступную информацию:
```sh
sudo nmap -sV 192.168.1.1
```

На нашей машине запущен ftp, а поэтому мы можем попытаться рассмотреть эту службу подробнее с помощью стандартных скриптов nmap. Скрипты позволяют проверить порт более детально, найти возможные уязвимости. Для этого используйте опцию -sC и -p чтобы задать порт:
```sh
 sudo nmap -sC 192.168.56.102 -p 21
```

Мы выполняли скрипт по умолчанию, но есть еще и другие скрипты, например, найти все скрипты для ftp вы можете командой:
```sh
sudo find /usr/share/nmap/scripts/ -name '*.nse' | grep ftp
```
 
 Затем попытаемся использовать один из них, для этого достаточно указать его с помощью опции --script. Но сначала вы можете посмотреть информацию о скрипте:
```sh
sudo nmap --script-help ftp-brute.nse
```
 
 Этот скрипт будет пытаться определить логин и пароль от FTP на удаленном узле. Затем выполните скрипт:
```sh
sudo nmap --script ftp-brute.nse 192.168.1.1 -p 21 
```

Также можно запустить утилиту с опцией -A, она активирует более агрессивный режим работы утилиты, с помощью которого вы получите большую часть информации одной командой:
```sh
sudo nmap -A 192.168.1.1
```
---
### 2.  **Cовременный netstat**

``` sh
sudo ss -tulpn
```

Можно вывести только процессы, работающие на 80-том порту:
```sh
sudo ss -tulpn | grep :80
```
---
### 3.  **lsof**
Утилита lsof позволяет посмотреть все открытые в системе соединения, в том числе и сетевые, для этого нужно использовать опцию -i, а чтобы отображались именно порты, а не названия сетевых служб следует использовать опцию -P:
```sh
sudo lsof -i -P
```
Ещё один пример, смотрим какие процессы работают с портом 80:
```sh
sudo lsof -i -P | grep :80
```

## Текст скрипта

```bash
#!/bin/bash

# Переменные
WORK_DIR="/opt"
LOG_FILE="/var/log/optfiles.log"
CURRENT_DATE=$(date "+%Y-%m-%d %H:%M:%S")
SCRIPT_NAME=$(basename "$0")

# Функция для вывода списка пользователей в /opt
list_users() {
    echo "Список пользователей в каталоге $WORK_DIR:"
    ls -1 $WORK_DIR
}

# Запрос выбора пользователя
echo "Хотите выполнить скрипт для одного пользователя или для всех пользователей?"
echo "1) Один пользователь"
echo "2) Все пользователи"
read -p "Выберите вариант (1 или 2): " option

# Логируем дату, время и название скрипта в файл журнала
echo -e "\nДата и время запуска: $CURRENT_DATE" >> $LOG_FILE
echo "Название скрипта: $SCRIPT_NAME" >> $LOG_FILE

# Функция для подсчета файлов с расширением .elf
count_elf_files() {
    local dir="$1"
    find "$dir" -type f -name "*.elf" | wc -l
}

# Переменная для общего количества ELF-файлов
total_elf_count=0

if [ "$option" == "1" ]; then
    # Вывод списка пользователей
    list_users
    
    # Запрос имени пользователя
    read -p "Введите имя пользователя: " username
    
    # Проверка наличия каталога пользователя
    if [ ! -d "$WORK_DIR/$username" ]; then
        echo "Каталог для пользователя $username не найден."
        exit 1
    fi
    
    # Подсчет ELF-файлов для конкретного пользователя
    count=$(count_elf_files "$WORK_DIR/$username")
    
    # Логируем информацию о пользователе и количестве ELF-файлов
    echo "$username:$(id -u $username)    Количество ELF-файлов: $count" >> $LOG_FILE
    
    # Добавляем к общему количеству
    total_elf_count=$count
    
elif [ "$option" == "2" ]; then
    # Для всех пользователей
    for username in $(ls $WORK_DIR); do
        if [ -d "$WORK_DIR/$username" ]; then
            count=$(count_elf_files "$WORK_DIR/$username")
            
            # Логируем информацию о пользователе и количестве ELF-файлов
            echo "$username:$(id -u $username)    Количество ELF-файлов: $count" >> $LOG_FILE
            
            # Добавляем к общему количеству
            total_elf_count=$((total_elf_count + count))
        fi
    done
else
    echo "Некорректный выбор. Завершение работы."
    exit 1
fi

# Логируем общее количество ELF-файлов
echo -e "\nВсего файлов ELF: $total_elf_count" >> $LOG_FILE

echo "Сценарий завершен."
```

## Объяснение:
### Переменные

**Скрипт определяет переменные для работы**:

- `WORK_DIR` указывает путь к рабочему каталогу, в котором хранятся каталоги пользователей.
- `LOG_FILE` — путь к файлу журнала, в который будет записываться информация о выполнении скрипта.
- `CURRENT_DATE` содержит текущую дату и время в формате `YYYY-MM-DD HH:MM:SS``
- `SCRIPT_NAME` — имя исполняемого скрипта.


- `list_users()`: Выводит список всех пользователей, представленных в виде каталогов в рабочем каталоге.
- `count_elf_files()`: Подсчитывает количество файлов с расширением `.elf` в указанном каталоге.
- 
- **Запрашивает у пользователя выбор действия**:
    
    - Одна из двух опций: обработка данных для одного пользователя или для всех пользователей.
- **Записывает информацию в журнал**:
    
    - Логирует дату и время запуска, а также имя скрипта.
- **Выполняет основную логику**:
    
    - Если выбран вариант "1" (один пользователь), скрипт:
        - Показывает список пользователей.
        - Запрашивает имя пользователя.
        - Проверяет наличие каталога пользователя в рабочем каталоге.
        - Подсчитывает количество файлов `.elf` в каталоге этого пользователя.
        - Логирует информацию о пользователе и количестве `.elf`-файлов.
    - Если выбран вариант "2" (все пользователи) скрипт собирает информацию о всех пользователях в каталоге
1. **Подсчет ELF-файлов**:
    - Используем `find`, чтобы найти все исполняемые файлы, и `file`, чтобы проверить, являются ли они ELF-файлами.
2. **Логирование**:
    - Запись в лог добавляется с отметкой времени, указанием имени пользователя и количеством ELF-файлов.



### Журнал

1. **Запись данных в журнал**:
    
    - **`echo -e "\nДата и время запуска: $CURRENT_DATE"`** записывает текущую дату и время запуска.
    - **`echo "Название скрипта: $SCRIPT_NAME"`** записывает название сценария.
    - После этого для каждого пользователя (или для одного выбранного) записывается строка вида `имя пользователя:ID количество ELF-файлов`.
2. **Подсчет ELF-файлов**:
    
    - Для каждого пользователя скрипт использует команду `find` и `file`, чтобы найти все исполняемые ELF-файлы.
3. **Выбор пользователя**:
    
    - Пользователь может выбрать, выполнять ли скрипт для одного конкретного пользователя или для всех пользователей, имеющих каталоги в `/opt`.
4. **Формат логирования**:
    
	    - Информация записывается в файл `/var/log/optfiles.log`
	1. **Переменная `total_elf_count`**:
	    
	    - Инициализируем переменную `total_elf_count`, которая будет хранить общее количество ELF-файлов.
	2. **Подсчет и добавление к общему количеству**:
	В скрипте подсчет ELF-файлов происходит с использованием команды `find` и утилиты `wc`. Давайте разберем этот процесс более детально.

### Основные команды для подсчета

#### Команда `find`

Команда `find` используется для поиска файлов и каталогов в файловой системе. Она принимает ряд параметров, чтобы настроить условия поиска.

**Синтаксис:**

```bash
find [путь] [условия] [действия]
```

**В скрипте используется:**

```bash
find "$dir" -type f -name "*.elf"
```

**Объяснение параметров:**

- **`"$dir"`** — это путь к каталогу, в котором осуществляется поиск. В данном случае это каталог пользователя, для которого требуется подсчитать ELF-файлы.
  
- **`-type f`** — этот параметр указывает, что искать нужно только файлы. Это исключает каталоги и другие типы файловых объектов.
  
- **`-name "*.elf"`** — указывает условие поиска файлов с расширением `.elf`. Здесь `"*.elf"` — это шаблон, который соответствует всем файлам, заканчивающимся на `.elf`.

#### Команда `wc`

Команда `wc` (word count) используется для подсчета строк, слов и символов в файлах или потоке данных.

**Синтаксис:**

```bash
wc [опции] [файл]
```

**В скрипте используется:**

```bash
find "$dir" -type f -name "*.elf" | wc -l
```

**Объяснение параметров:**

- **`find "$dir" -type f -name "*.elf"`** — команда `find` ищет все файлы с расширением `.elf` в указанном каталоге и выводит их пути.
  
- **`|`** — это пайп (конвейер), который передает вывод команды `find` в качестве входных данных для следующей команды.
  
- **`wc -l`** — параметр `-l` указывает, что нужно подсчитать количество строк. Поскольку команда `find` выводит один путь на строку, то `wc -l` подсчитывает количество строк, что фактически является количеством файлов `.elf`.

### Подсчет ELF-файлов в скрипте

В скрипте подсчет ELF-файлов происходит в двух местах:

1. **Для одного пользователя:**

    Когда пользователь выбирает обработку данных для одного конкретного пользователя, скрипт выполняет следующие шаги:

    ```bash
    count=$(count_elf_files "$WORK_DIR/$username")
    ```

    - В этом вызове функция `count_elf_files` получает путь к каталогу пользователя (`"$WORK_DIR/$username"`).
    - Внутри функции, команда `find` ищет все файлы с расширением `.elf` в этом каталоге.
    - Затем `wc -l` подсчитывает количество строк в выводе команды `find`, что соответствует количеству файлов.

2. **Для всех пользователей:**

    Когда пользователь выбирает обработку данных для всех пользователей, скрипт выполняет следующие шаги:

    ```bash
    for username in $(ls $WORK_DIR); do
        if [ -d "$WORK_DIR/$username" ]; then
            count=$(count_elf_files "$WORK_DIR/$username")
            total_elf_count=$((total_elf_count + count))
        fi
    done
    ```

    - Здесь скрипт перебирает все каталоги в рабочем каталоге, представляющие пользователей.
    - Для каждого каталога выполняется подсчет ELF-файлов.
    - Результаты подсчета добавляются к переменной `total_elf_count`, которая хранит общее количество ELF-файлов для всех пользователей.

### Общий алгоритм

1. **Инициализация переменных:**
   - Задается начальное значение `total_elf_count` как `0`.

2. **Определение пути к каталогам:**
   - Для одного пользователя путь определен как `"$WORK_DIR/$username"`.
   - Для всех пользователей пути определяются как все каталоги в `"$WORK_DIR"`.

3. **Поиск и подсчет файлов:**
   - Используется `find` для поиска файлов с расширением `.elf`.
   - Результат передается в `wc -l` для подсчета числа строк, которое соответствует количеству найденных файлов.

4. **Логирование результатов:**
   - Записывается количество ELF-файлов для каждого пользователя или общее количество файлов для всех пользователей.

## Настройка `cron` для ежедневного запуска:

Для автоматического запуска этого сценария каждый день в 20:00:

1. Откройте файл crontab для редактирования:
    
    `crontab -e`
    
2. Добавьте следующую строку:
    
    `0 20 * * * /root/scripts/monitor.sh`
    

Это будет ежедневно запускать скрипт `monitor.sh` в 20:00
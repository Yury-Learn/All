
```bash
#!/bin/bash

# Определение переменных
user_file="/tmp/users_in_opt.txt"
log_file="/var/log/optfiles.log"
opt_dir="/opt"
home_dir="/home"

# Шаг 1: Получение списка пользователей, чьи домашние папки находятся в /opt
awk -F: '$6 ~ /^\/opt\// {print $1}' /etc/passwd > "$user_file"

# Проверка, если файл пользователей пуст
if [ ! -s "$user_file" ]; then
    echo "Нет пользователей с домашними папками в $opt_dir"
    exit 0
fi

# Шаг 2: Удаление папок пользователей в /opt и /home
while IFS= read -r user; do
    # Удаление папки пользователя в /opt
    user_opt_dir="$opt_dir/$user"
    if [ -d "$user_opt_dir" ]; then
        echo "Удаление папки пользователя в /opt: $user_opt_dir"
        rm -rf "$user_opt_dir"
    else
        echo "Папка пользователя не найдена в /opt: $user_opt_dir"
    fi

    # Удаление папки пользователя в /home
    user_home_dir="$home_dir/$user"
    if [ -d "$user_home_dir" ]; then
        echo "Удаление папки пользователя в /home: $user_home_dir"
        rm -rf "$user_home_dir"
    else
        echo "Папка пользователя не найдена в /home: $user_home_dir"
    fi
done < "$user_file"

# Шаг 3: Удаление пользователей из системы
while IFS= read -r user; do
    echo "Удаление пользователя: $user"
    userdel "$user" 2>/dev/null
done < "$user_file"

# Шаг 4: Удаление файла /var/log/optfiles.log
if [ -f "$log_file" ]; then
    echo "Удаление файла журнала: $log_file"
    rm -f "$log_file"
else
    echo "Файл журнала не найден: $log_file"
fi

# Очистка временного файла со списком пользователей
rm -f "$user_file"

echo "Скрипт выполнен успешно."
```

### Объяснение скрипта

1. **Определение переменных:**
   - `user_file` — временный файл для хранения списка пользователей.
   - `log_file` — путь к файлу журнала, который нужно удалить.
   - `opt_dir` — директория `/opt`, где находятся папки пользователей.
   - `home_dir` — директория `/home`, где также могут находиться папки пользователей.

2. **Шаг 1: Получение списка пользователей**
   - Используем `awk`, чтобы найти имена пользователей с домашними папками в `/opt` и записать их в `user_file`.

3. **Шаг 2: Удаление папок пользователей**
   - Для каждого пользователя из списка:
     - Проверяем и удаляем его папку в `/opt`, если она существует.
     - Проверяем и удаляем его папку в `/home`, если она существует.

4. **Шаг 3: Удаление пользователей**
   - Удаляем пользователей из системы с помощью `userdel`. Ошибки игнорируются для предотвращения лишнего вывода.

5. **Шаг 4: Удаление файла журнала**
   - Проверяем наличие файла журнала и удаляем его с помощью `rm -f`.

6. **Очистка временного файла**
   - Удаляем временный файл со списком пользователей.

7. **Сообщение о завершении**
   - Выводим сообщение о том, что скрипт успешно выполнен.

### Запуск скрипта

1. Сохраните скрипт в файл, например, `cleanup_users.sh`.
2. Сделайте файл исполняемым:

   ```bash
   chmod +x clear.sh
   ```

3. Запустите скрипт с правами суперпользователя:

   ```bash
   sudo ./clear.sh
   ```

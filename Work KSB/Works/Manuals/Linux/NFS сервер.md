---
tags: nfs, linux
---
## Общее

>/etc/exports
>/data _ipaddressremoteserver_ (rw)


```sh
exportfs -av
```
- Где:
	- -a считывает из файла /etc/exports
	- -v verbose
	- -без ключей увидим что раздётся
	- -s все параметры
	- -r при установке новых параметров

на клиенте
```sh
mount *ipaddrress:/data* /mnt
```
- /mnt куда хотим примонтировать

если посмотреть, можно увидеть размер 
```sh
df -h /mnt/ 
```

```sh
qemu-img convert -p -f vmdk -O qcow2 ./my_centos7.vmdk ./my_centos7.qcow2
```


NFS использует клиент-серверную архитектуру. Сервер с установленным пакетом NFS предоставляет доступ к своим директориям, а клиенты подключаются к нему через сеть. 

Передача данных происходит через пакеты протокола RPC (Remote Call Procedure), что делает работу системы надёжной даже при сбоях сети: при восстановлении соединения передача данных продолжается с того места, где она прервалась.

## 1. Настройка NFS

### 1️. Установка пакета NFS

На сервере, который будет предоставлять директории для доступа, установим необходимые пакеты:

```sh
sudo apt-get update
sudo apt-get install nfs-kernel-server

```
### 2. Создание директории для общего доступа

Создадим директорию, которую будем расшаривать:

```sh
sudo mkdir /var/nfs
```

Для совместимости с различными пользователями зададим права доступа:

```sh
sudo chown nobody:nogroup /var/nfs
```

### 3. Редактирование конфигурационного файла

Откроем файл конфигурации /etc/exports для редактирования:

```sh
sudo nano /etc/exports
```

Добавим строку:

>/var/nfs    10.10.0.10/24(rw,sync,no_subtree_check)

- Здесь:
	
	• /var/nfs — директория для общего доступа,
	• 10.10.0.10/24 — IP-адрес клиента (или сеть), которому предоставляется доступ,
	• rw — разрешение на чтение и запись,
	• sync — запись изменений на диск до ответа клиенту,
	• no_subtree_check — отключение проверки подкаталогов (ускоряет доступ к файлам).

### 4️. Применение настроек и запуск сервиса
Чтобы применить конфигурацию и запустить сервис NFS, выполните следующие команды:

```sh
sudo exportfs -a
sudo service nfs-kernel-server start
```

Теперь ваш NFS сервер готов, и клиенты смогут подключаться к указанной директории. Если потребуется подключить несколько клиентов, просто добавьте их IP-адреса в файл конфигурации.

### 5. Подключение клиента

На стороне клиента (например, на другом сервере с Ubuntu), можно подключить расшаренную директорию так:

```sh
sudo mount 10.10.0.10:/var/nfs /mnt
```

Где /mnt — локальная точка монтирования, которая будет содержать данные, хранящиеся на NFS сервере.